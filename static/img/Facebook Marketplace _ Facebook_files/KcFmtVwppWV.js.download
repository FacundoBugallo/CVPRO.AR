;/*FB_PKG_DELIM*/

__d("MAWIssueReceiverFetchTaskDeferred",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("MAWIssueReceiverFetchTask").__setRef("MAWIssueReceiverFetchTaskDeferred");function a(a,b,c,d,e){return h.load().then(function(f){return f.issueReceiverFetchTask(a,b,c,d,e)})}g.issueReceiverFetchTask=a}),98);
__d("MAWRetryReceiverFetchSticker",["FBLogger","MAWIssueReceiverFetchTaskDeferred","MAWMediaDownloadStatus","WAHashUtils","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,e,f){f==null?void 0:f.addPoint("receiver_fetch_retry_attempt");if(b==null){f==null?void 0:f.endFail("receiver_fetch_retry_no_attachment");return}var g=c("nullthrows")(b.receiverFetchId),h=b.messageId,i=b.threadKey,j=d("WAHashUtils").stringToPlaintextHash(h);e({tag:"IncreaseMediaDownloadRetryCount",value:{key:j}});c("promiseDone")(a,function(a){return d("MAWIssueReceiverFetchTaskDeferred").issueReceiverFetchTask(a,h,g,i,e)},function(a){f==null?void 0:f.endFail("receiver_fetch_task_fail"),e({tag:"UpdateMediaStatus",value:{details:"receiver_fetch_task_fail_"+a,key:j,status:c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE,type:"main"}}),c("FBLogger")("messenger_web_media").catching(a).warn("Failed to issue media receiver fetch task for manual retry")})}g.retryReceiverFetchSticker=a}),98);
__d("useMAWBulkMediaDownloadManualRetry",["MAWDbMedia","MAWDownloadMediaInWorkerDeferred","MAWRetryReceiverFetchSticker","MAWStateContext.react","WAHashUtils","isReceiverFetchSticker","react","react-forget-runtime","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useCallback;b.useContext;var i=b.c;function a(a,b){var e=i(7),f=c("useAsyncReStore")(),g=d("react-forget-runtime").useContextWithBailoutExperiment__unstable(d("MAWStateContext.react").MAWStateContext,l),h=g.dispatch,m=d("MAWStateContext.react").useMAWSelector(k),n=d("MAWStateContext.react").useMAWSelector(j);e[0]!==a||e[1]!==b||e[2]!==m||e[3]!==n||e[4]!==f||e[5]!==h?(g=function(){a.forEach(function(a){var e=c("isReceiverFetchSticker")(a);if(e){b==null?void 0:b.start({isManualRetry:!0,manualRetryCount:(e=m[a.messageId])!=null?e:0,previousManualRetryErrorDetails:(e=n[a.messageId])==null?void 0:e.mainMediaStatusDetails});d("MAWRetryReceiverFetchSticker").retryReceiverFetchSticker(f,a,h,b);return}e=a.attachmentFbid;var g=isNaN(e);g=g?d("WAHashUtils").stringToPlaintextHash(e):d("MAWDbMedia").convertNumberToMediaId(parseInt(e,10));b==null?void 0:b.start({isManualRetry:!0,manualRetryCount:(e=m[g.toString()])!=null?e:0,previousManualRetryErrorDetails:(e=n[g.toString()])==null?void 0:e.mainMediaStatusDetails});h({tag:"SetMediaDownloadStatusState",value:{key:g,newMediaDownloadState:null}});h({tag:"IncreaseMediaDownloadRetryCount",value:{key:g}});d("MAWDownloadMediaInWorkerDeferred").downloadMediaInWorker({attachment:a,dispatch:h,mediaRenderQpl:b,triggerUIView:"manual-retry-thread"})})},e[0]=a,e[1]=b,e[2]=m,e[3]=n,e[4]=f,e[5]=h,e[6]=g):g=e[6];return g}function j(a){return a.mediaDownloadStatus}function k(a){return a.mediaDownloadRetryCount}function l(a){return[a.dispatch]}g["default"]=a}),98);